<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart Toilet Dashboard</title>

  <!-- Supabase UMD -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>

  <style>
    body { font-family: Arial, sans-serif; background:#f8fafc; color:#0f172a; margin:0; padding:20px; }
    .wrap { max-width:600px; margin:auto; }
    h1 { text-align:center; }
    .reading { background:white; padding:16px; margin:12px 0; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.05); }
    .label { font-size:14px; color:#6b7280; }
    .value { font-size:22px; font-weight:bold; margin-top:4px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Smart Toilet — Latest Readings</h1>

    <div class="reading">
      <div class="label">Temperature (°C)</div>
      <div class="value" id="temp">--</div>
    </div>

    <div class="reading">
      <div class="label">Pressure (Pa)</div>
      <div class="value" id="pressure">--</div>
    </div>

    <div class="reading">
      <div class="label">VOC</div>
      <div class="value" id="voc">--</div>
    </div>

    <div class="reading">
      <div class="label">MQ2</div>
      <div class="value" id="mq2">--</div>
    </div>

    <div class="reading">
      <div class="label">MQ137</div>
      <div class="value" id="mq137">--</div>
    </div>
  </div>

<script>
  // ===== Supabase config =====
 
/* ====== CONFIG - replace these ====== */
const SUPABASE_URL = 'https://zxrghjceuouepfrqefuv.supabase.co'; // your project URL
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp4cmdoamNldW91ZXBmcnFlZnV2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxMDg1MjAsImV4cCI6MjA3NzY4NDUyMH0.wKadbFlhqP_XYCePnSXpwpuH2CIXXwYt6Pd7r0uqJPg';
/* ==================================== */

  // initialize client
  const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  // table name
  const TABLE = 'telemetry';

  // elements
  const tempEl = document.getElementById('temp');
  const pressureEl = document.getElementById('pressure');
  const vocEl = document.getElementById('voc');
  const mq2El = document.getElementById('mq2');
  const mq137El = document.getElementById('mq137');

  async function fetchLatestReading() {
    try {
      const { data, error } = await supabaseClient
        .from(TABLE)
        .select('*')
        .order('recorded_at', { ascending: false })
        .limit(1);

      if (error) { console.error(error); return; }
      if (!data || data.length === 0) return;

      const row = data[0];
      tempEl.textContent = row.temp ?? '--';
      pressureEl.textContent = row.pressure ?? '--';
      vocEl.textContent = row.voc ?? '--';
      mq2El.textContent = row.mq2 ?? '--';
      mq137El.textContent = row.mq137 ?? '--';
    } catch (err) {
      console.error('Fetch error', err);
    }
  }

  // fetch initially
  fetchLatestReading();

  // refresh every 5s
  setInterval(fetchLatestReading, 5000);
</script>
</body>
</html>
